 
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Processing &#8212; Dask Examples  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/style.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/images/favicon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ETL Pipelines with Prefect" href="prefect-etl.html" />
    <link rel="prev" title="Handle Evolving Workflows" href="evolving-workflows.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">

<nav class="dask-nav container-fluid">
  <ul>
    <li class="logo">
      <a href="https://docs.dask.org/">
        <img
          class="caption"
          src="../_static/images/dask-horizontal-white.svg"
        />
      </a>
    </li>

    <li>
      <a href="https://docs.dask.org/">Dask</a>
    </li>

    <li>
      <a href="https://distributed.dask.org/">Distributed</a>
    </li>

    <li>
      <a href="https://ml.dask.org/">Dask ML</a>
    </li>

    <li>
      <a href="https://examples.dask.org/">Examples</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/ecosystem.html">Ecosystem</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/support.html">Community</a>
    </li>
  </ul>
</nav>


    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Dask Examples  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../array.html">
   Dask Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bag.html">
   Dask Bags
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataframe.html">
   Dask DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../delayed.html">
   Custom Workloads with Dask Delayed
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../futures.html">
   Custom Workloads with Futures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning.html">
   Dask for Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../sql.html">
   Operating on Dask Dataframes with SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xarray.html">
   Xarray with Dask Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resilience.html">
   Resilience against hardware failures
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dataframes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dataframes/01-data-access.html">
   DataFrames: Read and Write Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataframes/02-groupby.html">
   DataFrames: Groupby
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataframes/03-from-pandas-to-dask.html">
   Gotchaâ€™s from Pandas to Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataframes/04-reading-messy-data-into-dataframes.html">
   DataFrames: Reading in messy data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/blockwise-ensemble.html">
   Blockwise Ensemble Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/scale-scikit-learn.html">
   Scale Scikit-Learn for Small Data Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/parallel-prediction.html">
   Score and Predict Large Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/torch-prediction.html">
   Batch Prediction with PyTorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/training-on-large-datasets.html">
   Train Models on Large Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/incremental.html">
   Incrementally Train Large Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/text-vectorization.html">
   Text Vectorization Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/hyperparam-opt.html">
   Hyperparameter optimization with Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/xgboost.html">
   Scale XGBoost
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/voting-classifier.html">
   Use Voting Classifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/tpot.html">
   Automate Machine Learning with TPOT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/glm.html">
   Generalized Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/svd.html">
   Singular Value Decomposition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="json-data-on-the-web.html">
   Analyze web-hosted JSON data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="async-await.html">
   Async/Await and Non-Blocking Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="async-web-server.html">
   Asynchronous Computation: Web Servers + Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="embarrassingly-parallel.html">
   Embarrassingly parallel Workloads
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="evolving-workflows.html">
   Handle Evolving Workflows
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Image Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prefect-etl.html">
   ETL Pipelines with Prefect
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stencils-with-numba.html">
   Stencil Computations with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="forecasting-with-prophet.html">
   Time Series Forecasting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User Surveys
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../surveys/2021.html">
   2021 Dask User Survey Results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../surveys/2020.html">
   2020 Dask User Survey Results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../surveys/2019.html">
   2019 Dask User Survey Results
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/applications/image-processing.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Setting-up-your-environment">
   Setting up your environment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Install-Extra-Dependencies">
     Install Extra Dependencies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Importing-dask-image">
   Importing dask-image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Getting-the-example-data">
   Getting the example data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Reading-in-image-data">
   Reading in image data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Reading-a-single-image">
     Reading a single image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Reading-multiple-images">
     Reading multiple images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Applying-your-own-custom-function-to-images">
   Applying your own custom function to images
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Embarrassingly-parallel-problems">
     Embarrassingly parallel problems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Joining-partial-images-together">
   Joining partial images together
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-segmentation-analysis-pipeline">
   A segmentation analysis pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Filtering">
     Filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Segmenting">
     Segmenting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Analyzing">
     Analyzing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Next-steps">
   Next steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Cleaning-up-temporary-directories-and-files">
   Cleaning up temporary directories and files
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Image Processing</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Setting-up-your-environment">
   Setting up your environment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Install-Extra-Dependencies">
     Install Extra Dependencies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Importing-dask-image">
   Importing dask-image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Getting-the-example-data">
   Getting the example data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Reading-in-image-data">
   Reading in image data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Reading-a-single-image">
     Reading a single image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Reading-multiple-images">
     Reading multiple images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Applying-your-own-custom-function-to-images">
   Applying your own custom function to images
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Embarrassingly-parallel-problems">
     Embarrassingly parallel problems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Joining-partial-images-together">
   Joining partial images together
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-segmentation-analysis-pipeline">
   A segmentation analysis pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Filtering">
     Filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Segmenting">
     Segmenting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Analyzing">
     Analyzing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Next-steps">
   Next steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Cleaning-up-temporary-directories-and-files">
   Cleaning up temporary directories and files
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition-live-notebook admonition">
<p class="admonition-title">Live Notebook</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab/tree/applications/image-processing.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab/tree/applications/image-processing.ipynb"><img alt="Binder" src="https://static.mybinder.org/badge_logo.svg" /></a> or view it <a class="reference external" href="https://github.com/dask/dask-examples/blob/main/applications/image-processing.ipynb">on Github</a>.</p>
</div>
<div class="section" id="Image-Processing">
<h1>Image Processing<a class="headerlink" href="#Image-Processing" title="Permalink to this headline">Â¶</a></h1>
<p>Welcome to the quickstart guide for dask-image.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Setting-up-your-environment">Setting up your environment</a></p></li>
<li><p><a class="reference external" href="#Importing-dask-image">Importing dask-image</a></p></li>
<li><p><a class="reference external" href="#Getting-the-example-data">Getting the example data</a></p></li>
<li><p><a class="reference external" href="#Reading-in-image-data">Reading in image data</a></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Reading-a-single-image">Reading a single image</a></p></li>
<li><p><a class="reference external" href="#Reading-multiple-images">Reading multiple images</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#Applying-your-own-custom-function-to-images">Applying your own custom function to images</a></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Embarrassingly-parallel-problems">Embarrassingly parallel problems</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#Joining-partial-images-together">Joining partial images together</a></p></li>
<li><p><a class="reference external" href="#A-segmentation-analysis-pipeline">A segmentation analysis pipeline</a></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Filtering">Filtering</a></p></li>
<li><p><a class="reference external" href="#Segmenting">Segmenting</a></p></li>
<li><p><a class="reference external" href="#Analyzing">Analyzing</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#Next-steps">Next steps</a></p></li>
<li><p><a class="reference external" href="#Cleaning-up-temporary-directories-and-files">Cleaning up temporary directories and files</a></p></li>
</ol>
<div class="section" id="Setting-up-your-environment">
<h2><a class="reference external" href="#Setting-up-your-environment">Setting up your environment</a><a class="headerlink" href="#Setting-up-your-environment" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Install-Extra-Dependencies">
<h3>Install Extra Dependencies<a class="headerlink" href="#Install-Extra-Dependencies" title="Permalink to this headline">Â¶</a></h3>
<p>We first install the library scikit-image for easier access to the example image data there.</p>
<p>If you are running this notebook on your own computer and not in the mybinder environment, youâ€™ll additionally need to ensure your Python environment contains: * dask * dask-image * python-graphviz * scikit-image * matplotlib * numpy</p>
<p>You can refer to the full list of dependencies used for the <code class="docutils literal notranslate"><span class="pre">dask-examples</span></code> repository, available in the <code class="docutils literal notranslate"><span class="pre">`binder/environment.yml</span></code> file here &lt;<a class="reference external" href="https://github.com/dask/dask-examples/blob/main/binder/environment.yml">https://github.com/dask/dask-examples/blob/main/binder/environment.yml</a>&gt;`__ (note that the <code class="docutils literal notranslate"><span class="pre">nomkl</span></code> package is not available for Windows users): <a class="reference external" href="https://github.com/dask/dask-examples/blob/main/binder/environment.yml">https://github.com/dask/dask-examples/blob/main/binder/environment.yml</a></p>
</div>
</div>
<div class="section" id="Importing-dask-image">
<h2><a class="reference external" href="#Importing-dask-image">Importing dask-image</a><a class="headerlink" href="#Importing-dask-image" title="Permalink to this headline">Â¶</a></h2>
<p>When you import dask-image, be sure to use an underscore instead of a dash between the two words.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask_image.imread</span>
<span class="kn">import</span> <span class="nn">dask_image.ndfilters</span>
<span class="kn">import</span> <span class="nn">dask_image.ndmeasure</span>
<span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
</pre></div>
</div>
</div>
<p>Weâ€™ll also use matplotlib to display image results in this notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="section" id="Getting-the-example-data">
<h2><a class="reference external" href="#Getting-the-example-data">Getting the example data</a><a class="headerlink" href="#Getting-the-example-data" title="Permalink to this headline">Â¶</a></h2>
<p>Weâ€™ll use some example image data from the scikit-image library in this tutorial. These images are very small, but will allow us to demonstrate the functionality of dask-image.</p>
<p>Letâ€™s download and save a public domain image of the astronaut Eileen Collins to a temporary directory. This image was originally downloaded from the NASA Great Images database <a class="reference external" href="https://flic.kr/p/r9qvLn">https://flic.kr/p/r9qvLn</a>, but weâ€™ll access it with scikit-imageâ€™s <code class="docutils literal notranslate"><span class="pre">data.astronaut()</span></code> method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir temp
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">io</span>

<span class="n">output_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;astronaut.png&#39;</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>Really large datasets often canâ€™t fit all of the data into a single file, so weâ€™ll chop this image into four parts and save the image tiles to a second temporary directory. This will give you a better idea of how you can use dask-image on a real dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir temp-tiles
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp-tiles&#39;</span><span class="p">,</span> <span class="s1">&#39;image-00.png&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()[:</span><span class="mi">256</span><span class="p">,</span> <span class="p">:</span><span class="mi">256</span><span class="p">,</span> <span class="p">:])</span>  <span class="c1"># top left</span>
<span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp-tiles&#39;</span><span class="p">,</span> <span class="s1">&#39;image-01.png&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()[:</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">:,</span> <span class="p">:])</span>  <span class="c1"># top right</span>
<span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp-tiles&#39;</span><span class="p">,</span> <span class="s1">&#39;image-10.png&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()[</span><span class="mi">256</span><span class="p">:,</span> <span class="p">:</span><span class="mi">256</span><span class="p">,</span> <span class="p">:])</span>  <span class="c1"># bottom left</span>
<span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp-tiles&#39;</span><span class="p">,</span> <span class="s1">&#39;image-11.png&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()[</span><span class="mi">256</span><span class="p">:,</span> <span class="mi">256</span><span class="p">:,</span> <span class="p">:])</span>  <span class="c1"># bottom right</span>
</pre></div>
</div>
</div>
<p>Now we have some data saved, letâ€™s practise reading in files with dask-image and processing our images.</p>
</div>
<div class="section" id="Reading-in-image-data">
<h2><a class="reference external" href="#Reading-in-image-data">Reading in image data</a><a class="headerlink" href="#Reading-in-image-data" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Reading-a-single-image">
<h3><a class="reference external" href="#Reading-a-single-image">Reading a single image</a><a class="headerlink" href="#Reading-a-single-image" title="Permalink to this headline">Â¶</a></h3>
<p>Letâ€™s load a public domain image of the astronaut Eileen Collins with dask-image <a class="reference external" href="http://image.dask.org/en/latest/dask_image.imread.html">imread()</a>. This image was originally downloaded from the NASA Great Images database <a class="reference external" href="https://flic.kr/p/r9qvLn">https://flic.kr/p/r9qvLn</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;astronaut.png&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
temp/astronaut.png
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">astronaut</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">imread</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">astronaut</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>  <span class="c1"># display the first (and only) frame of the image</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dask.array&lt;_map_read_frame, shape=(1, 512, 512, 3), dtype=uint8, chunksize=(1, 512, 512, 3), chunktype=numpy.ndarray&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7f4523f22f70&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_23_2.png" src="../_images/applications_image-processing_23_2.png" />
</div>
</div>
<p>This has created a dask array with <code class="docutils literal notranslate"><span class="pre">shape=(1,</span> <span class="pre">512,</span> <span class="pre">512,</span> <span class="pre">3)</span></code>. This means it contains one image frame with 512 rows, 512 columns, and 3 color channels.</p>
<p>Since the image is relatively small, it fits entirely within one dask-image chunk, with <code class="docutils literal notranslate"><span class="pre">chunksize=(1,</span> <span class="pre">512,</span> <span class="pre">512,</span> <span class="pre">3)</span></code>.</p>
</div>
<div class="section" id="Reading-multiple-images">
<h3><a class="reference external" href="#Reading-multiple-images">Reading multiple images</a><a class="headerlink" href="#Reading-multiple-images" title="Permalink to this headline">Â¶</a></h3>
<p>In many cases, you may have multiple images stored on disk, for example: <code class="docutils literal notranslate"><span class="pre">image_00.png</span></code>, <code class="docutils literal notranslate"><span class="pre">image_01.png</span></code>, â€¦ <code class="docutils literal notranslate"><span class="pre">image_NN.png</span></code>. These can be read into a dask array as multiple image frames.</p>
<p>Here we have the astronaut image split into four non-overlapping tiles: * <code class="docutils literal notranslate"><span class="pre">image_00.png</span></code> = top left image (index 0,0) * <code class="docutils literal notranslate"><span class="pre">image_01.png</span></code> = top right image (index 0,1) * <code class="docutils literal notranslate"><span class="pre">image_10.png</span></code> = bottom left image (index 1,0) * <code class="docutils literal notranslate"><span class="pre">image_11.png</span></code> = bottom right image (index 1,1)</p>
<p>This filename pattern can be matched with regex: <code class="docutils literal notranslate"><span class="pre">image-*.png</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls temp-tiles
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
image-00.png  image-01.png  image-10.png  image-11.png
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">filename_pattern</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;temp-tiles&#39;</span><span class="p">,</span> <span class="s1">&#39;image-*.png&#39;</span><span class="p">)</span>
<span class="n">tiled_astronaut_images</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">imread</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filename_pattern</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tiled_astronaut_images</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dask.array&lt;_map_read_frame, shape=(4, 256, 256, 3), dtype=uint8, chunksize=(1, 256, 256, 3), chunktype=numpy.ndarray&gt;
</pre></div></div>
</div>
<p>This has created a dask array with <code class="docutils literal notranslate"><span class="pre">shape=(4,</span> <span class="pre">256,</span> <span class="pre">256,</span> <span class="pre">3)</span></code>. This means it contains four image frames; each with 256 rows, 256 columns, and 3 color channels.</p>
<p>There are four chunks in this particular case. Each image frame here is a separate chunk with <code class="docutils literal notranslate"><span class="pre">chunksize=(1,</span> <span class="pre">256,</span> <span class="pre">256,</span> <span class="pre">3)</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tiled_astronaut_images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tiled_astronaut_images</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tiled_astronaut_images</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tiled_astronaut_images</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_31_0.png" src="../_images/applications_image-processing_31_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Applying-your-own-custom-function-to-images">
<h2><a class="reference external" href="#Applying-your-own-custom-function-to-images">Applying your own custom function to images</a><a class="headerlink" href="#Applying-your-own-custom-function-to-images" title="Permalink to this headline">Â¶</a></h2>
<p>Next youâ€™ll want to do some image processing, and apply a function to your images.</p>
<p>Weâ€™ll use a very simple example: converting an RGB image to grayscale. But you can also use this method to apply arbittrary functions to dask images. To convert our image to grayscale, weâ€™ll use the equation to calculate luminance (<a class="reference external" href="http://www.poynton.com/PDFs/ColorFAQ.pdf">reference pdf</a>)â€œ:</p>
<p><code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">=</span> <span class="pre">0.2125</span> <span class="pre">R</span> <span class="pre">+</span> <span class="pre">0.7154</span> <span class="pre">G</span> <span class="pre">+</span> <span class="pre">0.0721</span> <span class="pre">B</span></code></p>
<p>Weâ€™ll write the function for this equation as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grayscale</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">((</span><span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.2125</span><span class="p">)</span> <span class="o">+</span>
              <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.7154</span><span class="p">)</span> <span class="o">+</span>
              <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.0721</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<p>Letâ€™s apply this function to the astronaut image we read in as a single file and visualize the computation graph.</p>
<p>(Visualizing the computation graph isnâ€™t necessary most of the time but itâ€™s helpful to know what dask is doing under the hood, and it can also be very useful for debugging problems.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_image_result</span> <span class="o">=</span> <span class="n">grayscale</span><span class="p">(</span><span class="n">astronaut</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">single_image_result</span><span class="p">)</span>
<span class="n">single_image_result</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dask.array&lt;add, shape=(1, 512, 512), dtype=float64, chunksize=(1, 512, 512), chunktype=numpy.ndarray&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_36_1.png" src="../_images/applications_image-processing_36_1.png" />
</div>
</div>
<p>We also see that there are no longer three color channels in the shape of the result, and that the output image is as expected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original image dimensions: &quot;</span><span class="p">,</span> <span class="n">astronaut</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processed image dimensions:&quot;</span><span class="p">,</span> <span class="n">single_image_result</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">astronaut</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>            <span class="c1"># display the first (and only) frame of the image</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">single_image_result</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>  <span class="c1"># display the first (and only) frame of the image</span>

<span class="c1"># Subplot headings</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Processed image&#39;</span><span class="p">)</span>

<span class="c1"># Don&#39;t display axes</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Display images</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original image dimensions:  (1, 512, 512, 3)
Processed image dimensions: (1, 512, 512)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_38_1.png" src="../_images/applications_image-processing_38_1.png" />
</div>
</div>
<div class="section" id="Embarrassingly-parallel-problems">
<h3><a class="reference external" href="#Embarrassingly-parallel-problems">Embarrassingly parallel problems</a><a class="headerlink" href="#Embarrassingly-parallel-problems" title="Permalink to this headline">Â¶</a></h3>
<p>The syntax is identical to apply a function to multiple images or dask chunks. This is an example of an embarrassingly parallel problem, and we see that dask automatically creates a computation graph for each chunk.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">grayscale</span><span class="p">(</span><span class="n">tiled_astronaut_images</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dask.array&lt;add, shape=(4, 256, 256), dtype=float64, chunksize=(1, 256, 256), chunktype=numpy.ndarray&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_41_1.png" src="../_images/applications_image-processing_41_1.png" />
</div>
</div>
<p>Letâ€™s take a look at the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">),</span> <span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Subplot headings</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First chunk&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Second chunk&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Thurd chunk&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fourth chunk&#39;</span><span class="p">)</span>

<span class="c1"># Don&#39;t display axes</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Display images</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_43_0.png" src="../_images/applications_image-processing_43_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Joining-partial-images-together">
<h2><a class="reference external" href="#Joining-partial-images-together">Joining partial images together</a><a class="headerlink" href="#Joining-partial-images-together" title="Permalink to this headline">Â¶</a></h2>
<p>OK, Things are looking pretty good! But how can we join these image chunks together?</p>
<p>So far, we havenâ€™t needed any information from neighboring pixels to do our calculations. But there are lots of functions (like those in <a class="reference external" href="https://dask-image.readthedocs.io/en/latest/dask_image.ndfilters.html">dask-image ndfilters</a>) that <em>do</em> need this for accurate results. You could end up with unwanted edge effects if you donâ€™t tell dask how your images should be joined.</p>
<p>Dask has several ways to join chunks together: <a class="reference external" href="http://docs.dask.org/en/latest/array-stack.html">Stack, Concatenate, and Block</a>.</p>
<p>Block is very versatile, so weâ€™ll use that in this next example. You simply pass in a list (or list of lists) to tell dask the spatial relationship between image chunks.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span>
<span class="n">combined_image</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">combined_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(512, 512)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7f4520aab670&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_47_2.png" src="../_images/applications_image-processing_47_2.png" />
</div>
</div>
</div>
<div class="section" id="A-segmentation-analysis-pipeline">
<h2><a class="reference external" href="#A-segmentation-analysis-pipeline">A segmentation analysis pipeline</a><a class="headerlink" href="#A-segmentation-analysis-pipeline" title="Permalink to this headline">Â¶</a></h2>
<p>Weâ€™ll walk through a simple image segmentation and analysis pipeline with three steps: 1. <a class="reference external" href="#Filtering">Filtering</a> 1. <a class="reference external" href="#Segmenting">Segmenting</a> 1. <a class="reference external" href="#Analyzing">Analyzing</a></p>
<div class="section" id="Filtering">
<h3><a class="reference external" href="#Filtering">Filtering</a><a class="headerlink" href="#Filtering" title="Permalink to this headline">Â¶</a></h3>
<p>Most analysis pipelines require some degree of image preprocessing. dask-image has a number of inbuilt filters available via <a class="reference external" href="https://dask-image.readthedocs.io/en/latest/dask_image.ndfilters.html">dask-image ndfilters</a></p>
<p>Commonly a guassian filter may used to smooth the image before segmentation. This causes some loss of sharpness in the image, but can improve segmentation quality for methods that rely on image thresholding.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smoothed_image</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">ndfilters</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">combined_image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>We see a small amount of blur in the smoothed image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">smoothed_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">smoothed_image</span> <span class="o">-</span> <span class="n">combined_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Subplot headings</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Smoothed image&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference from original&#39;</span><span class="p">)</span>

<span class="c1"># Don&#39;t display axes</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Display images</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_54_0.png" src="../_images/applications_image-processing_54_0.png" />
</div>
</div>
<p>Since the gaussian filter uses information from neighbouring pixels, the computational graph looks more complicated than the ones we looked at earlier. This is no longer embarrassingly parallel. Where possible dask keeps the computations for each of the four image chunks separate, but must combine information from different chunks near the edges.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smoothed_image</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_56_0.png" src="../_images/applications_image-processing_56_0.png" />
</div>
</div>
</div>
<div class="section" id="Segmenting">
<h3><a class="reference external" href="#Segmenting">Segmenting</a><a class="headerlink" href="#Segmenting" title="Permalink to this headline">Â¶</a></h3>
<p>After the image preprocessing, we segment regions of interest from the data. Weâ€™ll use a simple arbitrary threshold as the cutoff, at 75% of the maximum intensity of the smoothed image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold_value</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">smoothed_image</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">threshold_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
190.5550614819934
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold_image</span> <span class="o">=</span> <span class="n">smoothed_image</span> <span class="o">&gt;</span> <span class="n">threshold_value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">threshold_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7f4520c58760&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_60_1.png" src="../_images/applications_image-processing_60_1.png" />
</div>
</div>
<p>Next, we label each region of connected pixels above the threshold value. For this we use the <code class="docutils literal notranslate"><span class="pre">label</span></code> function from <a class="reference external" href="https://dask-image.readthedocs.io/en/latest/dask_image.ndmeasure.html">dask-image ndmeasure</a>. This will return both the label image, and the number of labels.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">label_image</span><span class="p">,</span> <span class="n">num_labels</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">ndmeasure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">threshold_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of labels:&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_labels</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">label_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of labels: 78
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7f4520c85d90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/applications_image-processing_63_2.png" src="../_images/applications_image-processing_63_2.png" />
</div>
</div>
</div>
<div class="section" id="Analyzing">
<h3><a class="reference external" href="#Analysing">Analyzing</a><a class="headerlink" href="#Analyzing" title="Permalink to this headline">Â¶</a></h3>
<p>There are a number of inbuilt functions in <a class="reference external" href="https://dask-image.readthedocs.io/en/latest/dask_image.ndmeasure.html">dask-image ndmeasure</a> useful for quantitative analysis.</p>
<p>Weâ€™ll use the <code class="docutils literal notranslate"><span class="pre">dask_image.ndmeasure.mean()</span></code> and <code class="docutils literal notranslate"><span class="pre">dask_image.ndmeasure.standard_deviation()</span></code> functions, and apply them to each label region with <code class="docutils literal notranslate"><span class="pre">dask_image.ndmeasure.labeled_comprehension()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_labels</span><span class="p">)))</span>  <span class="c1"># Note that we&#39;re including the background label=0 here, too.</span>
<span class="n">out_dtype</span> <span class="o">=</span> <span class="nb">float</span>  <span class="c1"># The data type we want to use for our results.</span>
<span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># The value to return if an element of index does not exist in the label image.</span>
<span class="n">mean_values</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">ndmeasure</span><span class="o">.</span><span class="n">labeled_comprehension</span><span class="p">(</span><span class="n">combined_image</span><span class="p">,</span> <span class="n">label_image</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">ndmeasure</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">out_dtype</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">pass_positions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_values</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 90.87492186 194.69185981 207.76964212 215.16959146 196.92609412
 206.50032105 217.0948     211.0477766  205.68146    208.61031956
 212.43803803 201.39967857 210.291275   198.3529809  201.21037636
 214.13041176 200.9344975  201.85547778 194.46485714 202.60302231
 205.20927983 203.72510602 205.94798756 205.88514047 207.33728
 216.13305227 206.7058     211.6957     211.75921279 224.71301613
 249.08085    215.87763779 198.27655577 213.67658483 205.65810758
 197.46586082 202.35786579 199.16034783 216.27194848 200.69137594
 220.99142573 207.66165    234.37771667 224.00188182 229.2705
 232.9163     187.1873     236.16183793 223.7469     187.813475
 227.4778     244.17155    225.49225806 239.4951     218.7795
 242.99015132 232.4975218  201.98308947 230.57158889 212.82135217
 242.21528571 241.32428889 228.722932   220.1454     239.55
 246.5        241.53348    236.28736    244.84466624 242.09528
 203.37236667 209.34061875 213.76621346 247.53468249 252.488826
 208.5659     197.72356    203.13211   ]
</pre></div></div>
</div>
<p>Since weâ€™re including label 0 in our index, itâ€™s not surprising that the first mean value is so much lower than the others - itâ€™s the background region below our cutoff threshold for segmentation.</p>
<p>Letâ€™s also calculate the standard deviation of the pixel values in our greyscale image.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stdev_values</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">ndmeasure</span><span class="o">.</span><span class="n">labeled_comprehension</span><span class="p">(</span><span class="n">combined_image</span><span class="p">,</span> <span class="n">label_image</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">ndmeasure</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">,</span> <span class="n">out_dtype</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">pass_positions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, letâ€™s load our analysis results into a pandas table and then save it as a csv file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_values</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;standard_deviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stdev_values</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>mean</th>
      <th>standard_deviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>90.874922</td>
      <td>65.452828</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>194.691860</td>
      <td>2.921235</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>207.769642</td>
      <td>11.411058</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>215.169591</td>
      <td>9.193374</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>196.926094</td>
      <td>5.215053</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;example_analysis_results.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved example_analysis_results.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Saved example_analysis_results.csv
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Next-steps">
<h2><a class="reference external" href="#Next-steps">Next steps</a><a class="headerlink" href="#Next-steps" title="Permalink to this headline">Â¶</a></h2>
<p>I hope this guide has helped you to get started with dask-image.</p>
<p><strong>Documentation</strong></p>
<p>You can read more about dask-image in the <a class="reference external" href="https://dask-image.readthedocs.io/en/latest/api.html">dask-image documentation</a> and <a class="reference external" href="https://dask-image.readthedocs.io/en/latest/api.html">API reference</a>. Documentation for <a class="reference external" href="http://docs.dask.org/en/latest/">dask is here</a>.</p>
<p>The dask-examples repository has a number of other example notebooks: <a class="reference external" href="https://github.com/dask/dask-examples">https://github.com/dask/dask-examples</a></p>
<p><strong>Scaling up with dask distributed</strong></p>
<p>If you want to send dask jobs to a computing cluster for distributed processing, you should take a look at <a class="reference external" href="https://distributed.dask.org/en/latest/">dask distributed</a>. There is also a <a class="reference external" href="https://distributed.dask.org/en/latest/quickstart.html">quickstart guide available</a>.</p>
<p><strong>Saving image data with zarr</strong></p>
<p>In some cases it may be necessary to save large data after image processing, <a class="reference external" href="https://zarr.readthedocs.io/en/stable/">zarr</a> is a python library that you may find useful.</p>
</div>
<div class="section" id="Cleaning-up-temporary-directories-and-files">
<h2><a class="reference external" href="#Cleaning-up-temporary-directories-and-files">Cleaning up temporary directories and files</a><a class="headerlink" href="#Cleaning-up-temporary-directories-and-files" title="Permalink to this headline">Â¶</a></h2>
<p>You recall we saved some example data to the directories <code class="docutils literal notranslate"><span class="pre">temp/</span></code> and <code class="docutils literal notranslate"><span class="pre">temp-tiles/</span></code>. To delete the contents, run the following command:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>rm -r temp
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>rm -r temp-tiles
</pre></div>
</div>
</div>
</div>
</div>
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18218894-16', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="evolving-workflows.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Handle Evolving Workflows</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="prefect-etl.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ETL Pipelines with Prefect</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Dask Developers<br/>
    
        &copy; Copyright 2018, Dask Developers.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>