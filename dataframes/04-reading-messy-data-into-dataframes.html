 
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DataFrames: Reading in messy data &#8212; Dask Examples  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/style.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/images/favicon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Blockwise Ensemble Methods" href="../machine-learning/blockwise-ensemble.html" />
    <link rel="prev" title="Gotcha’s from Pandas to Dask" href="03-from-pandas-to-dask.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">

<nav class="dask-nav container-fluid">
  <ul>
    <li class="logo">
      <a href="https://docs.dask.org/">
        <img
          class="caption"
          src="../_static/images/dask-horizontal-white.svg"
        />
      </a>
    </li>

    <li>
      <a href="https://docs.dask.org/">Dask</a>
    </li>

    <li>
      <a href="https://distributed.dask.org/">Distributed</a>
    </li>

    <li>
      <a href="https://ml.dask.org/">Dask ML</a>
    </li>

    <li>
      <a href="https://examples.dask.org/">Examples</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/ecosystem.html">Ecosystem</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/support.html">Community</a>
    </li>
  </ul>
</nav>


    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Dask Examples  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../array.html">
   Dask Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bag.html">
   Dask Bags
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataframe.html">
   Dask DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../delayed.html">
   Custom Workloads with Dask Delayed
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../futures.html">
   Custom Workloads with Futures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning.html">
   Dask for Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../sql.html">
   Operating on Dask Dataframes with SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xarray.html">
   Xarray with Dask Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resilience.html">
   Resilience against hardware failures
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dataframes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-data-access.html">
   DataFrames: Read and Write Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-groupby.html">
   DataFrames: Groupby
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-from-pandas-to-dask.html">
   Gotcha’s from Pandas to Dask
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   DataFrames: Reading in messy data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/blockwise-ensemble.html">
   Blockwise Ensemble Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/scale-scikit-learn.html">
   Scale Scikit-Learn for Small Data Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/parallel-prediction.html">
   Score and Predict Large Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/torch-prediction.html">
   Batch Prediction with PyTorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/training-on-large-datasets.html">
   Train Models on Large Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/incremental.html">
   Incrementally Train Large Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/text-vectorization.html">
   Text Vectorization Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/hyperparam-opt.html">
   Hyperparameter optimization with Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/xgboost.html">
   Scale XGBoost
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/voting-classifier.html">
   Use Voting Classifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/tpot.html">
   Automate Machine Learning with TPOT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/glm.html">
   Generalized Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/svd.html">
   Singular Value Decomposition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/json-data-on-the-web.html">
   Analyze web-hosted JSON data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/async-await.html">
   Async/Await and Non-Blocking Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/async-web-server.html">
   Asynchronous Computation: Web Servers + Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/embarrassingly-parallel.html">
   Embarrassingly parallel Workloads
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/evolving-workflows.html">
   Handle Evolving Workflows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/image-processing.html">
   Image Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/prefect-etl.html">
   ETL Pipelines with Prefect
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/stencils-with-numba.html">
   Stencil Computations with Numba
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../applications/forecasting-with-prophet.html">
   Time Series Forecasting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User Surveys
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../surveys/2021.html">
   2021 Dask User Survey Results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../surveys/2020.html">
   2020 Dask User Survey Results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../surveys/2019.html">
   2019 Dask User Survey Results
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/dataframes/04-reading-messy-data-into-dataframes.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   DataFrames: Reading in messy data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Start-Dask-Client-for-Dashboard">
     Start Dask Client for Dashboard
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-artificial-dataset">
     Create artificial dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Read-CSV-files">
     Read CSV files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Make-some-messy-data">
   Make some messy data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Reading-the-messy-data">
   Reading the messy data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Building-a-delayed-reader">
   Building a delayed reader
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Assembling-the-dask-dataframe">
   Assembling the dask dataframe
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Now-let’s-see-if-this-works">
     Now let’s see if this works
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Success!">
     Success!
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>DataFrames: Reading in messy data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   DataFrames: Reading in messy data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Start-Dask-Client-for-Dashboard">
     Start Dask Client for Dashboard
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-artificial-dataset">
     Create artificial dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Read-CSV-files">
     Read CSV files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Make-some-messy-data">
   Make some messy data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Reading-the-messy-data">
   Reading the messy data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Building-a-delayed-reader">
   Building a delayed reader
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Assembling-the-dask-dataframe">
   Assembling the dask dataframe
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Now-let’s-see-if-this-works">
     Now let’s see if this works
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Success!">
     Success!
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition-live-notebook admonition">
<p class="admonition-title">Live Notebook</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab/tree/dataframes/04-reading-messy-data-into-dataframes.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab/tree/dataframes/04-reading-messy-data-into-dataframes.ipynb"><img alt="Binder" src="https://static.mybinder.org/badge_logo.svg" /></a> or view it <a class="reference external" href="https://github.com/dask/dask-examples/blob/main/dataframes/04-reading-messy-data-into-dataframes.ipynb">on Github</a>.</p>
</div>
<div class="section" id="DataFrames:-Reading-in-messy-data">
<h1>DataFrames: Reading in messy data<a class="headerlink" href="#DataFrames:-Reading-in-messy-data" title="Permalink to this headline">¶</a></h1>
<p>In the <a class="reference internal" href="01-data-access.html"><span class="doc">01-data-access</span></a> example we show how Dask Dataframes can read and store data in many of the same formats as Pandas dataframes. One key difference, when using Dask Dataframes is that instead of opening a single file with a function like <a class="reference external" href="https://docs.dask.org/en/latest/generated/dask.dataframe.read_csv.html">pandas.read_csv</a>, we typically open many files at once with
<a class="reference external" href="https://docs.dask.org/en/latest/dataframe-api.html#dask.dataframe.read_csv">dask.dataframe.read_csv</a>. This enables us to treat a collection of files as a single dataset. Most of the time this works really well. But real data is messy and in this notebook we will explore a more advanced technique to bring messy datasets into a dask dataframe.</p>
<div class="section" id="Start-Dask-Client-for-Dashboard">
<h2>Start Dask Client for Dashboard<a class="headerlink" href="#Start-Dask-Client-for-Dashboard" title="Permalink to this headline">¶</a></h2>
<p>Starting the Dask Client is optional. It will provide a dashboard which is useful to gain insight on the computation.</p>
<p>The link to the dashboard will become visible when you create the client below. We recommend having it open on one side of your screen while using your notebook on the other side. This can take some effort to arrange your windows, but seeing them both at the same is very useful when learning.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">n_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="s1">&#39;2GB&#39;</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-09d1b3e6-e5d1-11ec-a360-6045bd6f4889</p>
        <table style="width: 100%; text-align: left;">

        <tr>

            <td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
            <td style="text-align: left;"><strong>Cluster type:</strong> distributed.LocalCluster</td>

        </tr>


            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard: </strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a>
                </td>
                <td style="text-align: left;"></td>
            </tr>


        </table>


            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;">LocalCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">5c4ea77a</p>
        <table style="width: 100%; text-align: left;">
            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a>
                </td>
                <td style="text-align: left;">
                    <strong>Workers:</strong> 1
                </td>
            </tr>
            <tr>
                <td style="text-align: left;">
                    <strong>Total threads:</strong> 4
                </td>
                <td style="text-align: left;">
                    <strong>Total memory:</strong> 1.86 GiB
                </td>
            </tr>

            <tr>
    <td style="text-align: left;"><strong>Status:</strong> running</td>
    <td style="text-align: left;"><strong>Using processes:</strong> True</td>
</tr>


        </table>

        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-fef3c624-6442-4156-890d-4a833074b87a</p>
            <table style="width: 100%; text-align: left;">
                <tr>
                    <td style="text-align: left;">
                        <strong>Comm:</strong> tcp://127.0.0.1:34883
                    </td>
                    <td style="text-align: left;">
                        <strong>Workers:</strong> 1
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a>
                    </td>
                    <td style="text-align: left;">
                        <strong>Total threads:</strong> 4
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Started:</strong> Just now
                    </td>
                    <td style="text-align: left;">
                        <strong>Total memory:</strong> 1.86 GiB
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;">Workers</h3>
        </summary>


        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;">Worker: 0</h4>
                </summary>
                <table style="width: 100%; text-align: left;">
                    <tr>
                        <td style="text-align: left;">
                            <strong>Comm: </strong> tcp://127.0.0.1:32899
                        </td>
                        <td style="text-align: left;">
                            <strong>Total threads: </strong> 4
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">
                            <strong>Dashboard: </strong> <a href="http://127.0.0.1:41851/status" target="_blank">http://127.0.0.1:41851/status</a>
                        </td>
                        <td style="text-align: left;">
                            <strong>Memory: </strong> 1.86 GiB
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">
                            <strong>Nanny: </strong> tcp://127.0.0.1:36375
                        </td>
                        <td style="text-align: left;"></td>
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: left;">
                            <strong>Local directory: </strong> /home/runner/work/dask-examples/dask-examples/dataframes/dask-worker-space/worker-83nh02_1
                        </td>
                    </tr>





                </table>
            </details>
            </div>
        </div>


    </details>
</div>

        </details>
    </div>
</div>
            </details>


    </div>
</div></div>
</div>
</div>
<div class="section" id="Create-artificial-dataset">
<h2>Create artificial dataset<a class="headerlink" href="#Create-artificial-dataset" title="Permalink to this headline">¶</a></h2>
<p>First we create an artificial dataset and write it to many CSV files.</p>
<p>You don’t need to understand this section, we’re just creating a dataset for the rest of the notebook.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">timeseries</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><strong>Dask DataFrame Structure:</strong></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>npartitions=30</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>int64</td>
      <td>object</td>
      <td>float64</td>
      <td>float64</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2000-01-30</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2000-01-31</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>
</div>
<div>Dask Name: make-timeseries, 30 tasks</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Provide date for filename given index</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; name(0)</span>
<span class="sd">    &#39;2000-01-01&#39;</span>
<span class="sd">    &gt;&gt;&gt; name(10)</span>
<span class="sd">    &#39;2000-01-11&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/*.csv&#39;</span><span class="p">,</span> <span class="n">name_function</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Read-CSV-files">
<h2>Read CSV files<a class="headerlink" href="#Read-CSV-files" title="Permalink to this headline">¶</a></h2>
<p>We now have many CSV files in our data directory, one for each day in the month of January 2000. Each CSV file holds timeseries data for that day. We can read all of them as one logical dataframe using the <code class="docutils literal notranslate"><span class="pre">dd.read_csv</span></code> function with a glob string.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls data/*.csv <span class="p">|</span> head
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
data/2000-01-01.csv
data/2000-01-02.csv
data/2000-01-03.csv
data/2000-01-04.csv
data/2000-01-05.csv
data/2000-01-06.csv
data/2000-01-07.csv
data/2000-01-08.csv
data/2000-01-09.csv
data/2000-01-10.csv
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/2000-*-*.csv&#39;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><strong>Dask DataFrame Structure:</strong></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>npartitions=30</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>int64</td>
      <td>object</td>
      <td>float64</td>
      <td>float64</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>
</div>
<div>Dask Name: read-csv, 30 tasks</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1010</td>
      <td>Laura</td>
      <td>-0.349083</td>
      <td>-0.820731</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1018</td>
      <td>George</td>
      <td>-0.803617</td>
      <td>-0.705560</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1025</td>
      <td>Quinn</td>
      <td>0.652247</td>
      <td>-0.360885</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1008</td>
      <td>Wendy</td>
      <td>0.979793</td>
      <td>0.048558</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1022</td>
      <td>Quinn</td>
      <td>0.769354</td>
      <td>0.875786</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Let’s look at some statistics on the data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.592000e+06</td>
      <td>2.592000e+06</td>
      <td>2.592000e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.000007e+03</td>
      <td>-3.207876e-04</td>
      <td>3.531596e-04</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.164607e+01</td>
      <td>5.776059e-01</td>
      <td>5.774679e-01</td>
    </tr>
    <tr>
      <th>min</th>
      <td>8.510000e+02</td>
      <td>-9.999994e-01</td>
      <td>-9.999996e-01</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9.790000e+02</td>
      <td>-4.954270e-01</td>
      <td>-4.919035e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000e+03</td>
      <td>4.831714e-03</td>
      <td>9.514034e-03</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.022000e+03</td>
      <td>5.043861e-01</td>
      <td>5.053812e-01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.161000e+03</td>
      <td>9.999977e-01</td>
      <td>9.999991e-01</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Make-some-messy-data">
<h1>Make some messy data<a class="headerlink" href="#Make-some-messy-data" title="Permalink to this headline">¶</a></h1>
<p>Now this works great, and in most cases dd.read_csv or dd.read_parquet etc are the preferred way to read in large collections of data files into a dask dataframe, but real world data is often very messy and some files may be broken or badly formatted. To simulate this we are going to create some fake messy data by tweaking our example csv files. For the file <code class="docutils literal notranslate"><span class="pre">data/2000-01-05.csv</span></code> we will replace with no data and for the file <code class="docutils literal notranslate"><span class="pre">data/2000-01-07.csv</span></code> we will remove the <code class="docutils literal notranslate"><span class="pre">y</span></code> column</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># corrupt the data in data/2000-01-05.csv</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/2000-01-05.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove y column from data/2000-01-07.csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/2000-01-07.csv&#39;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/2000-01-07.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head data/2000-01-05.csv
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head data/2000-01-07.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
id,name,x
989,Bob,-0.2558986367418856
1005,Ray,-0.1955571864255303
1034,Quinn,0.8246409903498171
1034,Frank,0.04319374077888
1000,Wendy,0.162699516207657
1026,Patricia,-0.9585458902941596
1004,Hannah,-0.0986353537881907
1015,Ursula,0.9615134502018844
973,Norbert,0.2821330510708342
</pre></div></div>
</div>
</div>
<div class="section" id="Reading-the-messy-data">
<h1>Reading the messy data<a class="headerlink" href="#Reading-the-messy-data" title="Permalink to this headline">¶</a></h1>
<p>Let’s try reading in the collection of files again</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/2000-*-*.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1010</td>
      <td>Laura</td>
      <td>-0.349083</td>
      <td>-0.820731</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1018</td>
      <td>George</td>
      <td>-0.803617</td>
      <td>-0.705560</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1025</td>
      <td>Quinn</td>
      <td>0.652247</td>
      <td>-0.360885</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1008</td>
      <td>Wendy</td>
      <td>0.979793</td>
      <td>0.048558</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1022</td>
      <td>Quinn</td>
      <td>0.769354</td>
      <td>0.875786</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Ok this looks like it worked, let us calculate the dataset statistics again</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Input <span class="ansi-green-fg">In [14]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">describe</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">compute</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/base.py:292</span>, in <span class="ansi-cyan-fg">DaskMethodsMixin.compute</span><span class="ansi-blue-fg">(self, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    268</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">compute</span>(<span style="color: rgb(0,135,0)">self</span>, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-intense-fg ansi-bold">    269</span>     <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Compute this dask collection</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span> <span style="color: rgb(175,0,0)">    This turns a lazy Dask collection into its in-memory equivalent.</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    290</span> <span style="color: rgb(175,0,0)">    dask.base.compute</span>
<span class="ansi-green-intense-fg ansi-bold">    291</span> <span style="color: rgb(175,0,0)">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 292</span>     (result,) <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">compute</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">traverse</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    293</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> result

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/base.py:575</span>, in <span class="ansi-cyan-fg">compute</span><span class="ansi-blue-fg">(traverse, optimize_graph, scheduler, get, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    572</span>     keys<span style="color: rgb(98,98,98)">.</span>append(x<span style="color: rgb(98,98,98)">.</span>__dask_keys__())
<span class="ansi-green-intense-fg ansi-bold">    573</span>     postcomputes<span style="color: rgb(98,98,98)">.</span>append(x<span style="color: rgb(98,98,98)">.</span>__dask_postcompute__())
<span class="ansi-green-fg">--&gt; 575</span> results <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">schedule</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">dsk</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">keys</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    576</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> repack([f(r, <span style="color: rgb(98,98,98)">*</span>a) <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> r, (f, a) <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">zip</span>(results, postcomputes)])

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/distributed/client.py:3004</span>, in <span class="ansi-cyan-fg">Client.get</span><span class="ansi-blue-fg">(self, dsk, keys, workers, allow_other_workers, resources, sync, asynchronous, direct, retries, priority, fifo_timeout, actors, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   3002</span>         should_rejoin <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>
<span class="ansi-green-intense-fg ansi-bold">   3003</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3004</span>     results <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">gather</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">packed</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">asynchronous</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">asynchronous</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">direct</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">direct</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3005</span> <span class="ansi-bold" style="color: rgb(0,135,0)">finally</span>:
<span class="ansi-green-intense-fg ansi-bold">   3006</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> f <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> futures<span style="color: rgb(98,98,98)">.</span>values():

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/distributed/client.py:2178</span>, in <span class="ansi-cyan-fg">Client.gather</span><span class="ansi-blue-fg">(self, futures, errors, direct, asynchronous)</span>
<span class="ansi-green-intense-fg ansi-bold">   2176</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">   2177</span>     local_worker <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">-&gt; 2178</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">   2179</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_gather</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2180</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">futures</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2181</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2182</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">direct</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">direct</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2183</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">local_worker</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">local_worker</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2184</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">asynchronous</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">asynchronous</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   2185</span> <span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/distributed/utils.py:318</span>, in <span class="ansi-cyan-fg">SyncMethodMixin.sync</span><span class="ansi-blue-fg">(self, func, asynchronous, callback_timeout, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    316</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> future
<span class="ansi-green-intense-fg ansi-bold">    317</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 318</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">    319</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">loop</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">callback_timeout</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">callback_timeout</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span>
<span class="ansi-green-intense-fg ansi-bold">    320</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/distributed/utils.py:385</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(loop, func, callback_timeout, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    383</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> error:
<span class="ansi-green-intense-fg ansi-bold">    384</span>     typ, exc, tb <span style="color: rgb(98,98,98)">=</span> error
<span class="ansi-green-fg">--&gt; 385</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> exc<span style="color: rgb(98,98,98)">.</span>with_traceback(tb)
<span class="ansi-green-intense-fg ansi-bold">    386</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    387</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> result

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/distributed/utils.py:358</span>, in <span class="ansi-cyan-fg">sync.&lt;locals&gt;.f</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    356</span>         future <span style="color: rgb(98,98,98)">=</span> asyncio<span style="color: rgb(98,98,98)">.</span>wait_for(future, callback_timeout)
<span class="ansi-green-intense-fg ansi-bold">    357</span>     future <span style="color: rgb(98,98,98)">=</span> asyncio<span style="color: rgb(98,98,98)">.</span>ensure_future(future)
<span class="ansi-green-fg">--&gt; 358</span>     result <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">yield</span> future
<span class="ansi-green-intense-fg ansi-bold">    359</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span>:
<span class="ansi-green-intense-fg ansi-bold">    360</span>     error <span style="color: rgb(98,98,98)">=</span> sys<span style="color: rgb(98,98,98)">.</span>exc_info()

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/tornado/gen.py:762</span>, in <span class="ansi-cyan-fg">Runner.run</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    759</span> exc_info <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-intense-fg ansi-bold">    761</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 762</span>     value <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">future</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">result</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    763</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span>:
<span class="ansi-green-intense-fg ansi-bold">    764</span>     exc_info <span style="color: rgb(98,98,98)">=</span> sys<span style="color: rgb(98,98,98)">.</span>exc_info()

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/distributed/client.py:2041</span>, in <span class="ansi-cyan-fg">Client._gather</span><span class="ansi-blue-fg">(self, futures, errors, direct, local_worker)</span>
<span class="ansi-green-intense-fg ansi-bold">   2039</span>         exc <span style="color: rgb(98,98,98)">=</span> CancelledError(key)
<span class="ansi-green-intense-fg ansi-bold">   2040</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">-&gt; 2041</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> exception<span style="color: rgb(98,98,98)">.</span>with_traceback(traceback)
<span class="ansi-green-intense-fg ansi-bold">   2042</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> exc
<span class="ansi-green-intense-fg ansi-bold">   2043</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> errors <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">skip</span><span style="color: rgb(175,0,0)">&#34;</span>:

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/optimization.py:990</span>, in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    988</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span style="color: rgb(0,135,0)">len</span>(args) <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(0,135,0)">len</span>(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>inkeys):
<span class="ansi-green-intense-fg ansi-bold">    989</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Expected </span><span class="ansi-bold" style="color: rgb(175,95,135)">%d</span><span style="color: rgb(175,0,0)"> args, got </span><span class="ansi-bold" style="color: rgb(175,95,135)">%d</span><span style="color: rgb(175,0,0)">&#34;</span> <span style="color: rgb(98,98,98)">%</span> (<span style="color: rgb(0,135,0)">len</span>(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>inkeys), <span style="color: rgb(0,135,0)">len</span>(args)))
<span class="ansi-green-fg">--&gt; 990</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> core<span style="color: rgb(98,98,98)">.</span>get(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>dsk, <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>outkey, <span style="color: rgb(0,135,0)">dict</span>(<span style="color: rgb(0,135,0)">zip</span>(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>inkeys, args)))

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/core.py:149</span>, in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> key <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> toposort(dsk):
<span class="ansi-green-intense-fg ansi-bold">    148</span>     task <span style="color: rgb(98,98,98)">=</span> dsk[key]
<span class="ansi-green-fg">--&gt; 149</span>     result <span style="color: rgb(98,98,98)">=</span> _execute_task(task, cache)
<span class="ansi-green-intense-fg ansi-bold">    150</span>     cache[key] <span style="color: rgb(98,98,98)">=</span> result
<span class="ansi-green-intense-fg ansi-bold">    151</span> result <span style="color: rgb(98,98,98)">=</span> _execute_task(out, cache)

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/core.py:119</span>, in <span class="ansi-cyan-fg">_execute_task</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>     func, args <span style="color: rgb(98,98,98)">=</span> arg[<span style="color: rgb(98,98,98)">0</span>], arg[<span style="color: rgb(98,98,98)">1</span>:]
<span class="ansi-green-intense-fg ansi-bold">    116</span>     <span style="color: rgb(95,135,135)"># Note: Don&#39;t assign the subtask results to a variable. numpy detects</span>
<span class="ansi-green-intense-fg ansi-bold">    117</span>     <span style="color: rgb(95,135,135)"># temporaries by their reference count and can execute certain</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>     <span style="color: rgb(95,135,135)"># operations in-place.</span>
<span class="ansi-green-fg">--&gt; 119</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> func(<span style="color: rgb(98,98,98)">*</span>(_execute_task(a, cache) <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> a <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> args))
<span class="ansi-green-intense-fg ansi-bold">    120</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> ishashable(arg):
<span class="ansi-green-intense-fg ansi-bold">    121</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> arg

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/utils.py:40</span>, in <span class="ansi-cyan-fg">apply</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">apply</span>(func, args, kwargs<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">None</span>):
<span class="ansi-green-intense-fg ansi-bold">     39</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> kwargs:
<span class="ansi-green-fg">---&gt; 40</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> func(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-intense-fg ansi-bold">     41</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">     42</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> func(<span style="color: rgb(98,98,98)">*</span>args)

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/dataframe/core.py:6436</span>, in <span class="ansi-cyan-fg">apply_and_enforce</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">   6434</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> meta
<span class="ansi-green-intense-fg ansi-bold">   6435</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> is_dataframe_like(df):
<span class="ansi-green-fg">-&gt; 6436</span>     check_matching_columns(meta, df)
<span class="ansi-green-intense-fg ansi-bold">   6437</span>     c <span style="color: rgb(98,98,98)">=</span> meta<span style="color: rgb(98,98,98)">.</span>columns
<span class="ansi-green-intense-fg ansi-bold">   6438</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:

File <span class="ansi-green-fg">/usr/share/miniconda3/envs/dask-examples/lib/python3.9/site-packages/dask/dataframe/utils.py:415</span>, in <span class="ansi-cyan-fg">check_matching_columns</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    413</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    414</span>     extra_info <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Order of columns does not match</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-fg">--&gt; 415</span> <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-intense-fg ansi-bold">    416</span>     <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">The columns in the computed data do not match</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    417</span>     <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)"> the columns in the provided metadata</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    418</span>     <span style="color: rgb(175,0,0)">f</span><span style="color: rgb(175,0,0)">&#34;</span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>extra_info<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    419</span> )

<span class="ansi-red-fg">ValueError</span>: The columns in the computed data do not match the columns in the provided metadata
  Extra:   []
  Missing: [&#39;y&#39;]
</pre></div></div>
</div>
<p>So what happened?</p>
<p>When creating a dask dataframe from a collection of files, dd.read_csv samples the first few files in the dataset to determine the datatypes and columns available. Since it has not opened all the files it does not now if some of them are corrupt. Hence, <code class="docutils literal notranslate"><span class="pre">df.head()</span></code> works since it is only looking at the first file. <code class="docutils literal notranslate"><span class="pre">df.describe.compute()</span></code> fails because of the corrupt data in <code class="docutils literal notranslate"><span class="pre">data/2000-01-05.csv</span></code></p>
</div>
<div class="section" id="Building-a-delayed-reader">
<h1>Building a delayed reader<a class="headerlink" href="#Building-a-delayed-reader" title="Permalink to this headline">¶</a></h1>
<p>To get around this problem we are going to use a more advanced technique to build our dask dataframe. This method can also be used any time some custom logic is required when reading each file. Essentially, we are going to build a function that uses pandas and some error checking and returns a pandas dataframe. If we find a bad data file we will either find a way to fix/clean the data or we will return and empty pandas dataframe with the same structure as the good data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

    <span class="c1"># for this to work we need to explicitly set the datatypes of our pandas dataframe</span>
    <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># try reading in the data with pandas</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># if this fails create an empty pandas dataframe with the same dtypes as the good data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>

    <span class="c1"># for the case with the missing column, add a column of data with NaN&#39;s</span>
    <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<p>Let’s test this function on a good file and the two bad files</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test function on a normal file</span>
<span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;data/2000-01-01.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1010</td>
      <td>Laura</td>
      <td>-0.349083</td>
      <td>-0.820731</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1018</td>
      <td>George</td>
      <td>-0.803617</td>
      <td>-0.705560</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1025</td>
      <td>Quinn</td>
      <td>0.652247</td>
      <td>-0.360885</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1008</td>
      <td>Wendy</td>
      <td>0.979793</td>
      <td>0.048558</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1022</td>
      <td>Quinn</td>
      <td>0.769354</td>
      <td>0.875786</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test function on the empty file</span>
<span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;data/2000-01-05.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test function on the file missing the y column</span>
<span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;data/2000-01-07.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>989</td>
      <td>Bob</td>
      <td>-0.255899</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1005</td>
      <td>Ray</td>
      <td>-0.195557</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1034</td>
      <td>Quinn</td>
      <td>0.824641</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1034</td>
      <td>Frank</td>
      <td>0.043194</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000</td>
      <td>Wendy</td>
      <td>0.162700</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Assembling-the-dask-dataframe">
<h1>Assembling the dask dataframe<a class="headerlink" href="#Assembling-the-dask-dataframe" title="Permalink to this headline">¶</a></h1>
<p>First we take our <code class="docutils literal notranslate"><span class="pre">read_data</span></code> function and convert it to a dask delayed function</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask</span> <span class="kn">import</span> <span class="n">delayed</span>
<span class="n">read_data</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let us look at what the function does now</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;data/2000-01-01.csv&#39;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Delayed(&#39;read_data-83ad0762-739f-4194-9c65-59f348cbe051&#39;)
</pre></div></div>
</div>
<p>It creates a delayed object, to actually run read the file we need to run <code class="docutils literal notranslate"><span class="pre">.compute()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1010</td>
      <td>Laura</td>
      <td>-0.349083</td>
      <td>-0.820731</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1018</td>
      <td>George</td>
      <td>-0.803617</td>
      <td>-0.705560</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1025</td>
      <td>Quinn</td>
      <td>0.652247</td>
      <td>-0.360885</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1008</td>
      <td>Wendy</td>
      <td>0.979793</td>
      <td>0.048558</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1022</td>
      <td>Quinn</td>
      <td>0.769354</td>
      <td>0.875786</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>86395</th>
      <td>984</td>
      <td>Oliver</td>
      <td>-0.882975</td>
      <td>0.783093</td>
    </tr>
    <tr>
      <th>86396</th>
      <td>1027</td>
      <td>Ursula</td>
      <td>0.442122</td>
      <td>-0.029759</td>
    </tr>
    <tr>
      <th>86397</th>
      <td>984</td>
      <td>Xavier</td>
      <td>0.207410</td>
      <td>-0.813991</td>
    </tr>
    <tr>
      <th>86398</th>
      <td>999</td>
      <td>Ursula</td>
      <td>0.740058</td>
      <td>-0.006924</td>
    </tr>
    <tr>
      <th>86399</th>
      <td>955</td>
      <td>George</td>
      <td>-0.135238</td>
      <td>-0.988232</td>
    </tr>
  </tbody>
</table>
<p>86400 rows × 4 columns</p>
</div></div>
</div>
<p>Now let’s build a list of all the available csv files</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loop over all the files</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/2000-*-*.csv&#39;</span><span class="p">)</span>
<span class="n">files</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;data/2000-01-27.csv&#39;,
 &#39;data/2000-01-15.csv&#39;,
 &#39;data/2000-01-10.csv&#39;,
 &#39;data/2000-01-01.csv&#39;,
 &#39;data/2000-01-13.csv&#39;,
 &#39;data/2000-01-14.csv&#39;,
 &#39;data/2000-01-21.csv&#39;,
 &#39;data/2000-01-30.csv&#39;,
 &#39;data/2000-01-29.csv&#39;,
 &#39;data/2000-01-28.csv&#39;,
 &#39;data/2000-01-20.csv&#39;,
 &#39;data/2000-01-11.csv&#39;,
 &#39;data/2000-01-07.csv&#39;,
 &#39;data/2000-01-22.csv&#39;,
 &#39;data/2000-01-08.csv&#39;,
 &#39;data/2000-01-02.csv&#39;,
 &#39;data/2000-01-04.csv&#39;,
 &#39;data/2000-01-05.csv&#39;,
 &#39;data/2000-01-17.csv&#39;,
 &#39;data/2000-01-23.csv&#39;,
 &#39;data/2000-01-26.csv&#39;,
 &#39;data/2000-01-16.csv&#39;,
 &#39;data/2000-01-24.csv&#39;,
 &#39;data/2000-01-03.csv&#39;,
 &#39;data/2000-01-06.csv&#39;,
 &#39;data/2000-01-18.csv&#39;,
 &#39;data/2000-01-12.csv&#39;,
 &#39;data/2000-01-19.csv&#39;,
 &#39;data/2000-01-25.csv&#39;,
 &#39;data/2000-01-09.csv&#39;]
</pre></div></div>
</div>
<p>Now we run the delayed read_data function on each file in the list</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Delayed(&#39;read_data-293ceeaa-0649-4587-b658-578e75c260e7&#39;),
 Delayed(&#39;read_data-0dd7b77e-d829-444d-b6ba-ba5d0e1a47ae&#39;),
 Delayed(&#39;read_data-6430d4bf-f2d1-4855-b816-23d2273d9cea&#39;),
 Delayed(&#39;read_data-802ca993-d618-449d-9be8-bc85ea88648b&#39;),
 Delayed(&#39;read_data-85d48ed9-d90b-423a-ad11-c90967af3ffe&#39;),
 Delayed(&#39;read_data-bf4a6229-c7fd-4f98-9b75-1a46d54d8406&#39;),
 Delayed(&#39;read_data-ed5a03b4-7ced-4f15-81b3-3c2c11f0a4d9&#39;),
 Delayed(&#39;read_data-b62907d9-86b4-4c98-b7c9-32c6f13bde48&#39;),
 Delayed(&#39;read_data-77c1e91e-1c3a-4d30-bc04-ab071debfb33&#39;),
 Delayed(&#39;read_data-406aeae4-df2d-4a27-a416-2d2fbd4e95d2&#39;),
 Delayed(&#39;read_data-613ebd01-c7b4-4ed8-8b56-7e2e4642765e&#39;),
 Delayed(&#39;read_data-6da4b48e-5be1-4f57-912f-66a249b716dd&#39;),
 Delayed(&#39;read_data-9c5b876f-604c-4e7d-808e-34fd745fe927&#39;),
 Delayed(&#39;read_data-362884fc-b903-4066-b948-ccb9e7eabd53&#39;),
 Delayed(&#39;read_data-b0f52fdb-9e51-4b6a-bf7d-dbbfce03fead&#39;),
 Delayed(&#39;read_data-380bb0b5-1b4b-4018-ae93-a2ce9bea728b&#39;),
 Delayed(&#39;read_data-64a01b16-3b81-4b1f-b636-185a910cd770&#39;),
 Delayed(&#39;read_data-ddfe1274-bb1a-477f-9f6a-27aa85d5acae&#39;),
 Delayed(&#39;read_data-dc5457a8-7e8c-425d-80f2-33e91f049b45&#39;),
 Delayed(&#39;read_data-045c9f8f-e39c-4ab5-87c7-712b72ed92a5&#39;),
 Delayed(&#39;read_data-0d768a4c-f6b1-479f-8cca-f08abcb38e89&#39;),
 Delayed(&#39;read_data-70d8a22a-6e18-4fa1-aff7-c49e10abbdc0&#39;),
 Delayed(&#39;read_data-e196b250-9490-445a-ae6c-0186d9b1275a&#39;),
 Delayed(&#39;read_data-8eecc442-f03f-4cd1-8098-1180c901ba15&#39;),
 Delayed(&#39;read_data-fb967ab9-4c72-4c0c-ab20-ae352bc9274c&#39;),
 Delayed(&#39;read_data-5a304212-0d97-4141-b9d2-73db7d3684e4&#39;),
 Delayed(&#39;read_data-4690b531-64e6-4da2-b831-ba7fb7d13abb&#39;),
 Delayed(&#39;read_data-0823fb4e-c582-483c-b2da-0e2ddf20bd3e&#39;),
 Delayed(&#39;read_data-ba56e2f3-565d-4a67-b08f-d6c8898f4a2b&#39;),
 Delayed(&#39;read_data-b4e1213c-07ff-4702-a6b5-31963630fa79&#39;)]
</pre></div></div>
</div>
<p>Then we use <a class="reference external" href="https://docs.dask.org/en/latest/generated/dask.dataframe.from_delayed.html">dask.dataframe.from_delayed</a>. This function creates a Dask DataFrame from a list of delayed objects as long as each delayed object returns a pandas dataframe. The structure of each individual dataframe returned must also be the same.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">from_delayed</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><strong>Dask DataFrame Structure:</strong></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>npartitions=30</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>int64</td>
      <td>object</td>
      <td>float64</td>
      <td>float64</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>
</div>
<div>Dask Name: from-delayed, 60 tasks</div></div>
</div>
<p>Note: we provided the dtypes in the <code class="docutils literal notranslate"><span class="pre">meta</span></code> keyword to explicitly tell Dask Dataframe what kind of dataframe to expect. If we did not do this Dask would infer this from the first delayed object which could be slow if it was a large csv file</p>
<div class="section" id="Now-let’s-see-if-this-works">
<h2>Now let’s see if this works<a class="headerlink" href="#Now-let’s-see-if-this-works" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1019</td>
      <td>Norbert</td>
      <td>0.690974</td>
      <td>0.008318</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1035</td>
      <td>Patricia</td>
      <td>0.653250</td>
      <td>0.470658</td>
    </tr>
    <tr>
      <th>2</th>
      <td>972</td>
      <td>Ingrid</td>
      <td>-0.865599</td>
      <td>0.594963</td>
    </tr>
    <tr>
      <th>3</th>
      <td>984</td>
      <td>Tim</td>
      <td>0.146003</td>
      <td>0.471499</td>
    </tr>
    <tr>
      <th>4</th>
      <td>948</td>
      <td>Ursula</td>
      <td>0.670260</td>
      <td>-0.015103</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.505600e+06</td>
      <td>2.505600e+06</td>
      <td>2.419200e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.000010e+03</td>
      <td>-2.676304e-04</td>
      <td>3.298364e-04</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.164298e+01</td>
      <td>5.776341e-01</td>
      <td>5.774504e-01</td>
    </tr>
    <tr>
      <th>min</th>
      <td>8.510000e+02</td>
      <td>-9.999994e-01</td>
      <td>-9.999996e-01</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9.790000e+02</td>
      <td>-4.954270e-01</td>
      <td>-4.919035e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000e+03</td>
      <td>4.831714e-03</td>
      <td>9.514034e-03</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.022000e+03</td>
      <td>5.043861e-01</td>
      <td>5.053812e-01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.161000e+03</td>
      <td>9.999977e-01</td>
      <td>9.999991e-01</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Success!">
<h2>Success!<a class="headerlink" href="#Success!" title="Permalink to this headline">¶</a></h2>
<p>To recap, in this example, we looked at an approach to create a Dask Dataframe from a collection of many data files. Typically you would use built-in functions like <code class="docutils literal notranslate"><span class="pre">dd.read_csv</span></code> or <code class="docutils literal notranslate"><span class="pre">dd.read_parquet</span></code> to do this. Sometimes, this is not possible because of messy/corrupted files in your dataset or some custom processing that might need to be done.</p>
<p>In these cases, you can build a Dask DataFrame with the following steps.</p>
<ol class="arabic simple">
<li><p>Create a regular python function that reads the data, performs any transformations, error checking etc and always returns a Pandas dataframe with the same structure</p></li>
<li><p>Convert this read function to a delayed object using the <code class="docutils literal notranslate"><span class="pre">dask.delayed</span></code> function</p></li>
<li><p>Call each file in your dataset with the delayed data reader and assemble the output as a list of delayed objects</p></li>
<li><p>Used <code class="docutils literal notranslate"><span class="pre">dd.from_delayed</span></code> to covert the list of delayed objects to a Dask Dataframe</p></li>
</ol>
<p>This same technique can be used in other situations as well. Another example might be data files that require using a specialized reader, or several transformations before they can be converted to a pandas dataframe.</p>
</div>
</div>
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18218894-16', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="03-from-pandas-to-dask.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Gotcha’s from Pandas to Dask</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../machine-learning/blockwise-ensemble.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Blockwise Ensemble Methods</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Dask Developers<br/>
    
        &copy; Copyright 2018, Dask Developers.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>